{
	"type": "xypdf",
	"description": "xyOps Portable Data Object",
	"version": "1.0",
	"items": [
		{
			"type": "plugin",
			"data": {
				"id": "pmly5byu8cw5lbwb",
				"title": "Join Notification",
				"enabled": true,
				"type": "action",
				"command": "pwsh",
				"script": "<#\n.SYNOPSIS\n\txyOps Join notification plugin - Sends a Join notification via API.\n\n.NOTES\n\tAuthor:         Nick Dollimount\n\tCopyright:      2026\n\n\tPlease see the README.md file for full documentation.\n#>\n\n# MARK: Send-JoinMessage\nfunction Send-JoinMessage {\n    param(\n        [Parameter(Mandatory = $true)][string]$DeviceID,\n        [Parameter(Mandatory = $true)][string]$APIKey,\n        [Parameter(Mandatory = $true)][string]$Title,\n        [Parameter(Mandatory = $true)][string]$Text,\n        [Parameter(Mandatory = $false)][string]$Uri\n    )\n\n    $notificationUri = \"https://joinjoaomgcd.appspot.com/_ah/api/messaging/v1/sendPush?apikey=$($APIKey)&text=$([System.Web.HttpUtility]::UrlEncode($Text))&title=$([System.Web.HttpUtility]::UrlEncode($Title))$((-not [string]::IsNullOrEmpty($Uri)) ? ('&url=' + [System.Web.HttpUtility]::UrlEncode($Uri)) : '')&deviceId=$($DeviceID)\"\n\n    try {\n        $results = Invoke-RestMethod -Uri $notificationUri | ConvertTo-Json -Depth 100 -Compress\n        Write-Information -MessageData ([PSCustomObject]@{\n            xy = 1\n            code = 0\n            description = \"Join notification sent successfull!\"\n            details = $results\n        } | ConvertTo-Json -Depth 100 -Compress) -InformationAction Continue\n    }\n    catch {\n        Write-Information -MessageData ([PSCustomObject]@{\n            xy = 1\n            code = 9\n            description = \"Join notification failed!\"\n            details = $results\n        } | ConvertTo-Json -Depth 100 -Compress) -InformationAction Continue\n    }\n}\n\n# MARK: Begin\n\n[PSCustomObject]$xyOps = ConvertFrom-Json -Depth 100 (Read-Host)\n\n$joinDeviceID = $xyOps.secrets.\"$($xyOps.params.deviceidvariable)\"\n$joinApiKey = $xyOps.secrets.\"$($xyOps.params.apikeyvariable)\"\n\nif (-not [string]::IsNullOrEmpty($xyOps.params.joinnotificationtext)) {\n    $joinNotificationText = $xyOps.params.joinnotificationtext\n}\nelse {\n    $joinNotificationText = $xyOps.text\n}\n\nif (-not [string]::IsNullOrEmpty($xyOps.params.joinnotificationtitle)) {\n    $joinNotificationTitle = $xyOps.params.joinnotificationtitle\n}\nelse {\n    $joinNotificationTitle = \"xyOps Alert\"\n}\n\nif (-not [string]::IsNullOrEmpty($xyOps.params.joinnotificationuri)) {\n    $joinNotificationUri = $xyOps.params.joinnotificationuri\n}\nelse {\n    $joinNotificationUri = $xyOps.links.job_details\n}\n\nSend-JoinMessage -DeviceID $joinDeviceID -APIKey $joinApiKey -Title $joinNotificationTitle -Text $joinNotificationText -Uri $joinNotificationUri",
				"groups": [],
				"format": "",
				"params": [
					{
						"id": "deviceidvariable",
						"title": "Device ID Secret Variable Name",
						"type": "text",
						"caption": "The name of the variable that stores the device ID in the secret vault.",
						"locked": true,
						"value": "XYOPS_JOIN_DEVICE_ID",
						"variant": "text",
						"required": true
					},
					{
						"id": "apikeyvariable",
						"title": "API Key Secret Variable Name",
						"type": "text",
						"caption": "The name of the variable that stores the API key in the secret vault.",
						"locked": true,
						"value": "XYOPS_JOIN_API_KEY",
						"variant": "text",
						"required": true
					},
					{
						"id": "joinnotificationtitle",
						"title": "Notification Title",
						"type": "text",
						"caption": "Override the default notification title of 'xyOps Alert'.",
						"locked": false,
						"value": "",
						"variant": "text",
						"required": false
					},
					{
						"id": "joinnotificationtext",
						"title": "Notification Text",
						"type": "textarea",
						"caption": "Override the default notification text that contains the alert text provided by the xyOps job results.",
						"locked": false,
						"value": "",
						"required": false
					},
					{
						"id": "joinnotificationuri",
						"title": "Notification Uri",
						"type": "text",
						"caption": "Override the default Uri that points to the job details.",
						"locked": false,
						"value": "",
						"variant": "url",
						"required": false
					}
				],
				"notes": "",
				"icon": "notification-clear-all",
				"uid": "",
				"gid": ""
			}
		}
	]
}